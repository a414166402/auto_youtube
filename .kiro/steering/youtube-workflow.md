# YouTube AI视频制作工具 - 业务逻辑

## 工作流程

```
创建项目 → 视频下载 → 分镜解析(可选，仅供参考) → 提示词编辑(含角色引用管理) → 图片生成 → 视频生成
```

## 核心概念

### 两种分镜
- **源视频分镜**: 从原始YouTube视频解析出的分镜，仅供参考展示，不影响后续流程
- **微创新视频分镜**: AI自动生成的提示词对应的分镜，数量与源视频分镜无关，由AI决定

### 角色配置与引用
- **角色映射配置**: 在Settings页面管理（上传角色参考图、设置名称）
- **角色引用**: 在提示词编辑页面选择已配置的角色（最多3个）
- 不需要单独的角色映射工作流步骤
- 用途：作为图片生成时"图文生图"的传入图片（最多3张）

### 主体类型扩展
- **三种主体类型**: 角色（Character）、物品（Object）、场景（Scene）
- **动态标识符**: A-Z，按顺序添加（添加A后才能添加B，以此类推）
- **设置页面**: 三个Tab页分别管理三种类型的主体库
- **项目映射**: 在提示词编辑页面配置"角色A/物品B/场景C对应哪个全局主体"
- **提示词引用格式**: `角色A`、`物品A`、`场景A` 等

## 各步骤详解

### 1. 分镜解析（可选）
- 解析源视频的分镜信息
- 仅供展示参考，不影响后续任何流程
- 项目列表显示源视频分镜数

### 2. 提示词编辑
- AI自动生成提示词和微创新分镜
- 不显示分镜缩略图
- 微创新分镜数量由AI决定，与源视频分镜数量无关
- 每个提示词包含：
  - `text_to_image`: 文生图/图文生图的文本提示词
  - `image_to_video`: 图生视频的文本提示词
  - `character_refs`: 角色引用（可选，从Settings配置中选择，最多3个）
- 项目列表显示微创新分镜数（依赖提示词是否已生成）

### 3. 图片生成
- **前置条件**: 提示词编辑完成（角色引用可选）
- **生成逻辑**:
  - 有角色引用 → 调用图文生图接口（角色引用图片 + text_to_image提示词）
  - 无角色引用 → 调用纯文生图接口（仅text_to_image提示词）

### 4. 视频生成
- **前置条件**:
  - 提示词编辑完成
  - 所有分镜的图片已生成
  - 用户已为每个分镜选择一张图片
- **生成逻辑**:
  - 输入图片：用户选择的图片
  - 输入文本：对应的 `image_to_video` 提示词

## 项目列表显示

项目卡片应显示两个分镜数：
1. 源视频总分镜数（来自分镜解析，可能为空）
2. 微创新视频总分镜数（来自提示词生成，依赖提示词是否已生成）
